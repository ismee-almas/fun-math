<!DOCTYPE html>
<html>
<head>
  <title>Fun Math World</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<!-- Profile Menu Button (hamburger icon) -->
<div id="menu-btn" class="menu-btn">&#9776;</div>

<!-- Sidebar Panel -->
<div id="sidebar" class="sidebar">
  <span class="closebtn" onclick="closeSidebar()">&times;</span>
  <h2>Your Profile</h2>
  <p><b>Name:</b> <span id="profile-name"></span></p>
  <p><b>Class:</b> <span id="profile-class"></span></p>
  <p><b>School:</b> <span id="profile-school"></span></p>
  <p><b>Visits:</b> <span id="profile-visits"></span></p>
  <p><b>Current Score:</b> <span id="profile-current-score"></span></p>
  <p><b>Cumulative Score:</b> <span id="profile-cumulative-score"></span></p>
</div>

  <div class="stars"></div>

  <!-- AUDIO EFFECTS -->
  <audio id="correctSound" src="https://cdn.pixabay.com/download/audio/2023/04/25/audio_65ae1bfa2c.mp3?filename=correct-2-46134.mp3"></audio>
  <audio id="wrongSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_1fd1b5f2af.mp3?filename=error-126627.mp3"></audio>

  <!-- HOME PAGE -->
  <div id="home-page" class="page">
    <div class="content-box">
      <h1>üé≤ Welcome to Fun Math World!</h1>
      <p>Play, learn, and become a Math Star! ‚ú®</p>
      <button onclick="startForm()">Let‚Äôs Start ‚û°Ô∏è</button>
      <div id="author-tag">By Mudassir</div>
    </div>
  </div>

  <!-- FORM SECTION -->
  <div id="form-section" class="page">
    <div class="form-card">
      <img src="https://github.com/ismee-almas/my-images/blob/main/math-fun4.jpg?raw=true" width="100">
      <h2>üåü Enter your details to start your Math Adventure! üåü</h2>
      <form id="studentForm">
        <input type="text" id="name" placeholder="üòÄ Your Name" required><br>
        <input type="text" id="class" placeholder="üìö Your Class" required><br>
        <input type="text" id="school" placeholder="üè´ Your School" required><br>
        <button type="submit">Play Now!</button>
      </form>
    </div>
  </div>

  <!-- GAME SECTION -->
  <div id="game-section" class="page">
    <div id="reaction" style="font-size: 60px; margin-bottom: 15px;">üòáüòáüòá</div>
    <div id="milestone-message" class="milestone"></div>

    <div class="game-card">
      <div id="score">Score: 0</div>
      <div id="mode-selection">
        <button type="button" onclick="setMode('add')">Explore Additions</button>
        <button type="button" onclick="setMode('sub')">Explore Subtractions</button>
        <button type="button" onclick="setMode('mul')">Explore Multiplications</button>
        <button type="button" onclick="setMode('div')">Explore Divisions</button>
        <button type="button" class="word-btn" onclick="tryWordProblems()">üéÉ Try Word Problems</button>
      </div>

      <div id="question-area" style="display:none;">
        <h2 id="question">Question appears here</h2>
        <input type="number" id="answerInput" placeholder="Type your answer">
        <button onclick="checkAnswer()">Submit Answer</button>
        <p id="feedback"></p>
        <button id="backButton" onclick="goBack()">‚¨Ö Back</button>
      </div>
    </div>
  </div>

  <!-- WORD PROBLEM SECTION -->
  <div id="word-section" class="page">
    <div class="word-card">
      <h2 id="word-problem">Word problem will appear here</h2>
      <input type="number" id="wordAnswerInput" placeholder="Type your answer">
      <button onclick="checkWordAnswer()">Submit</button>
      <p id="wordFeedback"></p>
      <div id="next-buttons" style="display:none;">
        <button onclick="nextWordProblem()">Yes</button>
        <button onclick="exitWordProblems()">No</button>
      </div>
      <button onclick="exitWordProblems()" class="back-main">‚¨Ö Back</button>
    </div>
  </div>

  <canvas id="confettiCanvas"></canvas>
  <canvas id="flowerCanvas"></canvas>

  <script>
    const form = document.getElementById("studentForm");
    const gameSection = document.getElementById("game-section");
    const formSection = document.getElementById("form-section");
    const homePage = document.getElementById("home-page");
    const scoreDisplay = document.getElementById("score");
    const milestoneMsg = document.getElementById("milestone-message");


    const correctSound = document.getElementById("correctSound");
    const wrongSound = document.getElementById("wrongSound");

    let studentData = {};
    let currentMode = "add";
    let correctAnswer;
    let score = 0;
let cumulativeScore = 0;
function openSidebar() {
  document.getElementById("sidebar").style.width = "280px";
  updateProfile();
}
function closeSidebar() {
  document.getElementById("sidebar").style.width = "0";
}

document.getElementById("menu-btn").addEventListener("click", openSidebar);

// Update the sidebar with latest info
function updateProfile() {
  document.getElementById("profile-name").textContent = studentData.name || "-";
  document.getElementById("profile-class").textContent = studentData.class || "-";
  document.getElementById("profile-school").textContent = studentData.school || "-";
  document.getElementById("profile-visits").textContent = visits || "1";
  document.getElementById("profile-current-score").textContent = score || "0";
  document.getElementById("profile-cumulative-score").textContent = cumulativeScore || score || "0";
}

    let addLevel = 1;  // controls difficulty level for additions
    let subLevel = 1;  // difficulty level for subtraction
    let mulLevel = 1;         // difficulty for multiplication
let mulCorrectStreak = 0;  // track correct answers at current level

let divLevel = 1;         // difficulty for division
let divCorrectStreak = 0;  // track correct answers at current level


let wordLevel = 1;
let wordCorrectStreak = 0;
let usedWordProblems = new Set();

let visits = 1;





    let correctCounts = { add: 0, sub: 0, mul: 0, div: 0 };

    function startForm() {
      correctSound.currentTime = 0;
      correctSound.play();
      homePage.style.display = "none";
      formSection.style.display = "flex";
    }

form.addEventListener("submit", async function (e) {
  e.preventDefault();

  studentData.name = document.getElementById("name").value.trim();
  studentData.class = document.getElementById("class").value.trim();
  studentData.school = document.getElementById("school").value.trim();

  if (!studentData.name || !studentData.class || !studentData.school) {
    alert("Please fill all fields");
    return;
  }

  try {
    // Fetch ALL rows
    const res = await fetch("https://sheetdb.io/api/v1/vtqyyfimz4iz1");
    const allData = await res.json();

    // Case-insensitive filter for this student
    const filtered = allData.filter(row =>
      row.Name?.toLowerCase() === studentData.name.toLowerCase() &&
      row.Class?.toLowerCase() === studentData.class.toLowerCase() &&
      row.School?.toLowerCase() === studentData.school.toLowerCase()
    );

    // Visits and cumulative score
    if (filtered.length > 0) {
      visits = parseInt(filtered[filtered.length - 1].Visits || "0") + 1;

      // Count all correct answers (before this session)
      cumulativeScore = filtered.filter(r => r.Correct === "Yes").length;
    } else {
      visits = 1;
      cumulativeScore = 0;
    }

  } catch (err) {
    console.error("Error fetching previous records:", err);
    visits = 1;
    cumulativeScore = 0;
  }

  // Move to game section
  formSection.style.display = "none";
  gameSection.style.display = "flex";

  // Show menu button only after login
  document.getElementById("menu-btn").style.display = "block";
});



    function setMode(mode) {
      currentMode = mode;
      document.getElementById("mode-selection").style.display = "none";
      document.getElementById("question-area").style.display = "block";
      generateQuestion();
    }

    function goBack() {
      document.getElementById("mode-selection").style.display = "flex";
      document.getElementById("question-area").style.display = "none";
      document.getElementById("feedback").textContent = "";
    }

    function rangeFor(mode) {
      if (mode === "mul" || mode === "div") {
        if (score < 3) return [10, 5];
        if (score < 6) return [20, 10];
        if (score < 10) return [50, 15];
        return [100, 20];
      } else {
        if (score < 3) return [9, 20];
        if (score < 6) return [50, 70];
        if (score < 10) return [100, 200];
        return [500, 999];
      }
    }

   function generateQuestion() {
  let a, b;
  let questionText;

  if (currentMode === "add") {
    // Adaptive ADDITION
    if (addLevel === 1) {
      a = Math.floor(Math.random() * 9) + 1;
      b = Math.floor(Math.random() * 9) + 1;
    } else if (addLevel === 2) {
      a = Math.floor(Math.random() * 9) + 1;
      b = Math.floor(Math.random() * 11) + 10; // 10-20
    } else if (addLevel === 3) {
      a = Math.floor(Math.random() * 41) + 10; // 10-50
      b = Math.floor(Math.random() * 41) + 10;
    } else if (addLevel === 4) {
      a = Math.floor(Math.random() * 201) + 100; // 100-300
      b = Math.floor(Math.random() * 201) + 100;
    } else {
      // hardest: 4-digit numbers
      a = Math.floor(Math.random() * 9000) + 1000;
      b = Math.floor(Math.random() * 9000) + 1000;
    }
    correctAnswer = a + b;
    questionText = `What is ${a} + ${b}?`;

  } else if (currentMode === "sub") {
    // Adaptive SUBTRACTION
    if (subLevel === 1) {
      a = Math.floor(Math.random() * 9) + 1;
      b = Math.floor(Math.random() * 9) + 1;
    } else if (subLevel === 2) {
      a = Math.floor(Math.random() * 11) + 10; // 10-20
      b = Math.floor(Math.random() * 9) + 1;
    } else if (subLevel === 3) {
      a = Math.floor(Math.random() * 41) + 10; // 10-50
      b = Math.floor(Math.random() * 41) + 10;
    } else if (subLevel === 4) {
      a = Math.floor(Math.random() * 201) + 100; // 100-300
      b = Math.floor(Math.random() * 201) + 100;
    } else {
      // hardest: 4-digit numbers
      a = Math.floor(Math.random() * 9000) + 1000;
      b = Math.floor(Math.random() * 9000) + 1000;
    }
    if (b > a) [a, b] = [b, a];
    correctAnswer = a - b;
    questionText = `What is ${a} - ${b}?`;

  } else if (currentMode === "mul") {
    // Adaptive MULTIPLICATION
    if (mulLevel === 1) {
      a = Math.floor(Math.random() * 9) + 1;
      b = Math.floor(Math.random() * 9) + 1;
    } else if (mulLevel === 2) {
      a = Math.floor(Math.random() * 11) + 10; // 10-20
      b = Math.floor(Math.random() * 9) + 1;
    } else if (mulLevel === 3) {
      a = Math.floor(Math.random() * 41) + 10; // 10-50
      b = Math.floor(Math.random() * 12) + 1;
    } else if (mulLevel === 4) {
      a = Math.floor(Math.random() * 101) + 50; // 50-150
      b = Math.floor(Math.random() * 20) + 2;
    } else {
      a = Math.floor(Math.random() * 900) + 100; // 100-999
      b = Math.floor(Math.random() * 50) + 2;
    }
    correctAnswer = a * b;
    questionText = `What is ${a} √ó ${b}?`;

  } else if (currentMode === "div") {
    // Adaptive DIVISION
    let factor1, factor2;
    if (divLevel === 1) {
      factor1 = Math.floor(Math.random() * 9) + 1;
      factor2 = Math.floor(Math.random() * 9) + 1;
    } else if (divLevel === 2) {
      factor1 = Math.floor(Math.random() * 11) + 10; // 10-20
      factor2 = Math.floor(Math.random() * 9) + 1;
    } else if (divLevel === 3) {
      factor1 = Math.floor(Math.random() * 41) + 10; // 10-50
      factor2 = Math.floor(Math.random() * 12) + 1;
    } else if (divLevel === 4) {
      factor1 = Math.floor(Math.random() * 101) + 50; // 50-150
      factor2 = Math.floor(Math.random() * 20) + 2;
    } else {
      factor1 = Math.floor(Math.random() * 900) + 100; // 100-999
      factor2 = Math.floor(Math.random() * 50) + 2;
    }
    let dividend = factor1 * factor2;
    correctAnswer = dividend / factor2;
    questionText = `What is ${dividend} √∑ ${factor2}?`;
  }

  // Display question
  document.getElementById("question").textContent = questionText;
  document.getElementById("answerInput").value = "";
  document.getElementById("feedback").textContent = "";
}


function checkAnswer() {
  const userAnswer = parseInt(document.getElementById("answerInput").value);
  const feedback = document.getElementById("feedback");
  const reaction = document.getElementById("reaction");
  const isCorrect = userAnswer === correctAnswer;

  if (isCorrect) {
    correctSound.play();
    feedback.textContent = "‚úÖ Great job! Keep going!";
    feedback.style.color = "black";
    feedback.style.fontWeight = "bold";

    score++;
cumulativeScore++;

    correctCounts[currentMode]++;
    scoreDisplay.textContent = "Score: " + score;
    reaction.textContent = "üòÑüéâ";

    // Adaptive difficulty rules
    if (currentMode === "add") {
      if (addLevel < 5) addLevel++;
    }

    if (currentMode === "sub") {
      if (subLevel < 5) subLevel++;
    }

    // Multiplication: 2 correct streak needed
    if (currentMode === "mul") {
      mulCorrectStreak++;
      if (mulCorrectStreak >= 2) {
        mulCorrectStreak = 0;
        if (mulLevel < 5) mulLevel++;
      }
    }

    // Division: 3 correct streak needed
    if (currentMode === "div") {
      divCorrectStreak++;
      if (divCorrectStreak >= 3) {
        divCorrectStreak = 0;
        if (divLevel < 5) divLevel++;
      }
    }

    // Send data with extended details
    sendData(
      studentData.name,
      studentData.class,
      studentData.school,
      "Yes",
      currentMode,
      document.getElementById("question").textContent,
      userAnswer,
      correctAnswer,
      currentMode === "add" ? addLevel :
currentMode === "sub" ? subLevel :
currentMode === "mul" ? mulLevel : divLevel

    );

    // Milestone celebration
    if (correctCounts[currentMode] % 5 === 0) {
      milestoneMsg.textContent = `Hurray!!! You have answered ${correctCounts[currentMode]} ${currentMode} questions!`;
      milestoneMsg.style.display = "block";
      launchConfetti();
      launchFlowers();
      setTimeout(() => (milestoneMsg.style.display = "none"), 2500);
    }

    launchConfetti();
    launchFlowers();

  } else {
    wrongSound.play();
    feedback.textContent = `‚ùå Oops! The correct answer is ${correctAnswer}. You can do it!`;
    feedback.style.color = "red";
    reaction.textContent = "üòüüò´";

    // Reset streaks for wrong answers
    if (currentMode === "mul") {
      mulCorrectStreak = 0;
    }
    if (currentMode === "div") {
      divCorrectStreak = 0;
    }

    sendData(
      studentData.name,
      studentData.class,
      studentData.school,
      "No",
      currentMode,
      document.getElementById("question").textContent,
      userAnswer,
      correctAnswer,
      currentMode === "add" ? addLevel :
currentMode === "sub" ? subLevel :
currentMode === "mul" ? mulLevel : divLevel

    );
  }

  // Next question after 3 seconds
  setTimeout(generateQuestion, 2500);
}



    function tryWordProblems() {
      if (correctCounts.add < 2 ||
          correctCounts.sub < 2 ||
          correctCounts.mul < 2 ||
          correctCounts.div < 2) {
        let msg = "You need to complete:\n";
        if (correctCounts.add < 2) msg += "‚Ä¢ At least 2 addition questions\n";
        if (correctCounts.sub < 2) msg += "‚Ä¢ At least 2 subtraction questions\n";
        if (correctCounts.mul < 2) msg += "‚Ä¢ At least 2 multiplication questions\n";
        if (correctCounts.div < 2) msg += "‚Ä¢ At least 2 division questions\n";
        alert(msg);
        return;
      }
      gameSection.style.display = "none";
      wordSection.style.display = "flex";
      generateWordProblem();
    }

    const wordSection = document.getElementById("word-section");
    const wordProblem = document.getElementById("word-problem");
    const wordFeedback = document.getElementById("wordFeedback");
    const nextButtons = document.getElementById("next-buttons");
const wordProblemsByLevel = {
  1: [
    { q: "Josh has 5 apples and buys 7 more. How many apples does he have now?", a: 12 },
    { q: "Surabhi has 8 pencils. Her friend gives her 4 more. How many pencils in total?", a: 12 },
    { q: "Adam had 10 chocolates and ate 3. How many chocolates are left?", a: 7 },
    { q: "Soni read 6 pages in the morning and 5 pages at night. How many pages did she read in total?", a: 11 },
    { q: "There are 7 dogs in the park. 2 more join. How many dogs are there now?", a: 9 },
    { q: "Allen has 15 balloons. 5 balloons burst. How many balloons remain?", a: 10 },
    { q: "There are 3 red balls and 6 blue balls. How many balls are there in total?", a: 9 },
    { q: "10 birds are sitting on a tree. 4 fly away. How many birds are still on the tree?", a: 6 },
    { q: "Amar had 12 toffees and he ate 7. How many toffees are left?", a: 5 },
    { q: "Sam picked 9 flowers and then picked 5 more. How many flowers does he have?", a: 14 },
    { q: "There are 8 oranges on the table. 3 oranges are eaten. How many oranges are left?", a: 5 },
    { q: "Shyam got 2 mangoes and his friend gave him 5 more. How many mangoes does Ali have now?", a: 7 },
    { q: "7 kids are playing in the park. 2 kids go home. How many kids are still playing?", a: 5 },
    { q: "There are 12 balloons and 3 flew away. How many balloons are left?", a: 9 },
    { q: "Raju saw 7 butterflies in the garden. Later he saw 8 more. How many butterflies in total?", a: 15 },
    { q: "A class has 20 chairs. 9 chairs are broken. How many good chairs remain?", a: 11 },
    { q: "There are 10 ducks in a pond. 3 leave the pond. How many ducks are left?", a: 7 },
    { q: "Sara planted 4 trees and later planted 6 more. How many trees did she plant in total?", a: 10 },
    { q: "Ranvir has 13 marbles. He gives 5 to his friend. How many marbles does Zaid have now?", a: 8 },
    { q: "Abhi has 9 pens. Her father buys 5 more for her. How many pens does she have now?", a: 14 }
  ],

  2: [
    { q: "There are 23 birds on a tree. 12 more birds join. How many birds are there now?", a: 35 },
    { q: "Rajiv has 45 rupees and spends 18 rupees. How much money is left with him?", a: 27 },
    { q: "There are 28 students in class. 9 are absent today. How many students are present?", a: 19 },
    { q: "A shop has 32 marbles. 15 marbles are sold. How many are left in the shop?", a: 17 },
    { q: "There are 50 mangoes. 21 mangoes are eaten. How many are left?", a: 29 },
    { q: "In a bus there are 35 passengers. 12 get off. How many are still in the bus?", a: 23 },
    { q: "Sara has 25 chocolates. Her mother gives her 15 more. How many chocolates does she have now?", a: 40 },
    { q: "A farmer has 40 hens. 18 hens run away. How many hens are left?", a: 22 },
    { q: "A library had 60 books. 25 were borrowed. How many books are in the library now?", a: 35 },
    { q: "Zara baked 38 cupcakes. She gave 12 to her friends. How many are left?", a: 26 },
    { q: "John has 17 toy cars. He buys 23 more. How many toy cars does Hamid have now?", a: 40 },
    { q: "A bag has 44 oranges. 11 oranges are spoiled. How many good oranges remain?", a: 33 },
    { q: "In a garden there are 55 roses. 20 are plucked. How many roses remain?", a: 35 },
    { q: "A farmer has 33 goats. He sells 12 goats. How many goats are left?", a: 21 },
    { q: "In a shop there are 47 pencils. 18 pencils are sold. How many pencils are left?", a: 29 },
    { q: "A school has 29 teachers. 16 new teachers join. How many teachers are there now?", a: 45 },
    { q: "A box has 44 sweets. 11 are eaten. How many sweets remain?", a: 33 },
    { q: "In a garden there are 60 flowers. 25 are picked. How many flowers remain?", a: 35 },
    { q: "Arvind read 38 pages on Monday and 12 on Tuesday. How many pages did he read in total?", a: 50 },
    { q: "Rani has 47 apples. 18 apples are eaten. How many apples are left?", a: 29 }
  ],

  3: [
    { q: "There are 6 baskets, each basket has 4 mangoes. How many mangoes are there in total?", a: 24 },
    { q: "A hall has 3 rows of chairs with 5 chairs in each row. How many chairs are there in total?", a: 15 },
    { q: "7 bags have 6 balls each. How many balls in total?", a: 42 },
    { q: "12 chocolates are shared equally among 4 kids. How many chocolates does each kid get?", a: 3 },
    { q: "There are 5 plates with 8 bananas on each plate. How many bananas are there in total?", a: 40 },
    { q: "16 pencils are divided equally among 8 students. How many pencils does each student get?", a: 2 },
    { q: "A gardener planted 9 rows of 3 trees each. How many trees in total?", a: 27 },
    { q: "A baker made 20 cookies and packed them equally into 4 boxes. How many cookies per box?", a: 5 },
    { q: "There are 4 tables, each with 6 chairs. How many chairs in total?", a: 24 },
    { q: "24 balloons are divided among 8 children. How many balloons does each child get?", a: 3 },
    { q: "3 shelves have 9 books each. How many books in total?", a: 27 },
    { q: "A farmer has 18 eggs. He packs them equally into 6 trays. How many eggs per tray?", a: 3 },
    { q: "There are 2 rows of 10 flower pots each. How many pots in total?", a: 20 },
    { q: "Ali has 4 bags with 7 apples in each bag. How many apples in total?", a: 28 },
    { q: "Sara bought 3 boxes of crayons with 12 crayons in each. How many crayons total?", a: 36 },
    { q: "48 sweets are distributed equally among 6 kids. How many sweets does each get?", a: 8 },
    { q: "10 shelves hold 5 books each. How many books total?", a: 50 },
    { q: "A teacher gives 20 pencils equally to 5 students. How many per student?", a: 4 },
    { q: "There are 3 packs of 15 stickers each. How many stickers in total?", a: 45 },
    { q: "25 chocolates are packed equally in 5 boxes. How many chocolates per box?", a: 5 }
  ],

  4: [
    { q: "There are 9 classrooms with 12 benches each. How many benches in total?", a: 108 },
    { q: "A farmer has 30 mangoes and divides them equally among 5 friends. How many mangoes per friend?", a: 6 },
    { q: "100 biscuits are packed into packets of 20. How many packets will there be?", a: 5 },
    { q: "A library has 8 shelves with 15 books each. How many books in total?", a: 120 },
    { q: "A teacher has 72 pencils and divides them equally among 8 students. How many pencils per student?", a: 9 },
    { q: "7 rows of 14 chairs each are arranged. How many chairs in total?", a: 98 },
    { q: "6 groups of 16 balloons each. How many balloons in total?", a: 96 },
    { q: "A box contains 12 chocolates. If 8 boxes are there, how many chocolates?", a: 96 },
    { q: "Zayan has 55 pens. He divides them equally into 11 boxes. How many pens per box?", a: 5 },
    { q: "There are 20 tables, each table has 7 chairs. How many chairs in total?", a: 140 },
    { q: "81 bananas are divided equally among 9 baskets. How many bananas per basket?", a: 9 },
    { q: "A box contains 44 cookies. 4 children share them equally. How many per child?", a: 11 },
    { q: "9 rows of 13 students each. How many students in total?", a: 117 },
    { q: "A class has 12 benches with 12 students on each. How many students total?", a: 144 },
    { q: "Arun has 25 kites. He makes 5 bundles with equal number of kites. How many kites per bundle?", a: 5 },
    { q: "A farmer collects 28 sacks of rice with 6 kg in each. How much rice in total?", a: 168 },
    { q: "14 buses carry 11 children each. How many children in total?", a: 154 },
    { q: "4 groups of 25 cows. How many cows in total?", a: 100 },
    { q: "10 trees with 7 mangoes each. How many mangoes?", a: 70 },
    { q: "6 rooms with 18 chairs each. How many chairs total?", a: 108 }
  ],

  5: [
    { q: "Tom bought 3 packs of stickers with 10 stickers each. He gave 8 stickers to a friend. How many stickers does he have now?", a: 22 },
    { q: "A farmer has 25 mangoes. He collects 15 more and divides them equally among 4 friends. How many does each friend get?", a: 10 },
    { q: "A shop sells 5 bags with 12 toys each, and 15 toys are sold separately. How many toys are there in total?", a: 75 },
    { q: "Allen read 12 pages on Monday, 15 on Tuesday, and 20 on Wednesday. How many pages in total?", a: 47 },
    { q: "A basket has 24 apples. After selling 10, 5 more apples are added. How many apples are in the basket now?", a: 19 },
    { q: "There are 3 shelves with 15 books each. 10 books are borrowed. How many books are left?", a: 35 },
    { q: "45 sweets are divided into 5 jars. How many sweets per jar?", a: 9 },
    { q: "A box has 8 rows of eggs with 10 eggs each. 25 eggs are used. How many eggs are left?", a: 55 },
    { q: "50 students are divided into 5 equal groups. How many students in each group?", a: 10 },
    { q: "Sara buys 5 packets of biscuits with 20 biscuits each and eats 15 biscuits. How many biscuits remain?", a: 85 },
    { q: "In a shop, 4 shelves hold 12 jars each. 10 jars are sold. How many jars remain?", a: 38 },
    { q: "A teacher has 4 boxes with 15 pens each. She distributes 20 pens. How many pens are left?", a: 40 },
    { q: "A farmer harvested 36 carrots and placed them in 6 baskets. How many carrots per basket?", a: 6 },
    { q: "A painter paints 2 walls daily. How many walls will he paint in 7 days?", a: 14 },
    { q: "10 bicycles each have 2 wheels. How many wheels in total?", a: 20 },
    { q: "In a cinema, 5 rows with 15 seats each are filled. 30 seats are empty. How many seats are filled?", a: 45 },
    { q: "Ali scored 12 marks in English, 18 in Maths and 20 in Science. What is his total score?", a: 50 },
    { q: "A school has 4 buses. Each bus carries 30 students. How many students in all buses?", a: 120 },
    { q: "5 trays of 8 glasses each. 7 glasses are broken. How many glasses are left?", a: 33 },
    { q: "12 boxes with 10 pencils each. 15 pencils are used. How many pencils are left?", a: 105 }
  ]
};


   function generateWordProblem() {
  const problems = wordProblemsByLevel[wordLevel];

  // Remove problems that have already been used
  let available = problems.filter(p => !usedWordProblems.has(p.q));

  // Reset if all problems at this level have been used
  if (available.length === 0) {
    usedWordProblems.clear();
    available = problems;
  }

  // Randomly choose a problem
  const wp = available[Math.floor(Math.random() * available.length)];

  // Mark as used
  usedWordProblems.add(wp.q);

  // Show the problem
  wordProblem.textContent = wp.q;
  wordProblem.dataset.answer = wp.a;
  wordFeedback.textContent = "";
  document.getElementById("wordAnswerInput").value = "";
  nextButtons.style.display = "none";
}


  function checkWordAnswer() {
  const user = parseInt(document.getElementById("wordAnswerInput").value);
  const ans = parseInt(wordProblem.dataset.answer);

  // Check correctness
  const isCorrect = (user === ans);

  if (isCorrect) {
    correctSound.play();
    wordFeedback.textContent = "üéâ Correct! Ready for next question?";
    wordFeedback.style.color = "green";

    // Update streak and level
    wordCorrectStreak++;
    if (wordCorrectStreak >= 2) {
      wordCorrectStreak = 0;
      if (wordLevel < 5) wordLevel++;
    }

    // Launch celebration animations
    launchConfetti();
    launchFlowers();

  } else {
    wrongSound.play();
    wordFeedback.textContent = `‚ùå Wrong! Correct answer: ${ans}. Do you want to try another question?`;
    wordFeedback.style.color = "red";

    // Reset streak on wrong answer
    wordCorrectStreak = 0;
  }

  // Log this word problem attempt to SheetDB
// Log using the unified sendData function
sendData(
  studentData.name,
  studentData.class,
  studentData.school,
  isCorrect ? "Yes" : "No",
  "word",
  wordProblem.textContent,
  user,
  ans,
  wordLevel
);

  // Show Yes/No buttons after every attempt
  nextButtons.style.display = "block";
}

    

    function nextWordProblem() { generateWordProblem(); }
    function exitWordProblems() {
      wordSection.style.display = "none";
      gameSection.style.display = "flex";
    }

    // Confetti animation
    const canvas = document.getElementById("confettiCanvas");
    const ctx = canvas.getContext("2d");
    let confettiParticles = [];
    function resizeCanvas() { canvas.width=window.innerWidth; canvas.height=window.innerHeight; }
    window.addEventListener("resize", resizeCanvas); resizeCanvas();
    function launchConfetti() {
      for (let i=0;i<100;i++){
        confettiParticles.push({x:Math.random()*canvas.width,y:-10,
          color:`hsl(${Math.random()*360},100%,50%)`,
          size:Math.random()*6+2,speed:Math.random()*3+2});
      }
      requestAnimationFrame(updateConfetti);
    }
    function updateConfetti() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      confettiParticles.forEach(p=>{
        p.y+=p.speed;
        ctx.fillStyle=p.color;
        ctx.fillRect(p.x,p.y,p.size,p.size);
      });
      confettiParticles=confettiParticles.filter(p=>p.y<canvas.height);
      if(confettiParticles.length>0) requestAnimationFrame(updateConfetti);
    }

    // Celebration animation with images
    const flowerCanvas = document.getElementById("flowerCanvas");
    const flowerCtx = flowerCanvas.getContext("2d");
    let particles = [];

    const loadedImages = [];
    celebrationImages.forEach(src => {
      const img = new Image();
      img.src = src;
      loadedImages.push(img);
    });

    function resizeCelebrationCanvas() {
      flowerCanvas.width = window.innerWidth;
      flowerCanvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resizeCelebrationCanvas);
    resizeCelebrationCanvas();

    function launchFlowers() {
      for (let i = 0; i < 30; i++) {
        const img = loadedImages[Math.floor(Math.random() * loadedImages.length)];
        particles.push({
          img: img,
          x: Math.random() * flowerCanvas.width,
          y: -20,
          speed: Math.random() * 2 + 1,
          size: Math.random() * 40 + 20
        });
      }
      requestAnimationFrame(updateCelebration);
    }

    function updateCelebration() {
      flowerCtx.clearRect(0, 0, flowerCanvas.width, flowerCanvas.height);
      particles.forEach(p => {
        flowerCtx.drawImage(p.img, p.x, p.y, p.size, p.size);
        p.y += p.speed;
      });
      particles = particles.filter(p => p.y < flowerCanvas.height);
      if (particles.length > 0) requestAnimationFrame(updateCelebration);
    }

    // Send data to SheetDB
    function sendData(name, studentClass, school, correct, mode, question, givenAnswer, correctAnswer, level) {
  const timestamp = new Date().toLocaleString();

  const payload = {
    data: [
      {
        Name: name,
        Class: studentClass,
        School: school,
        Visits: visits,
        Mode: mode,
        Question: question,
        GivenAnswer: givenAnswer,
        CorrectAnswer: correctAnswer,
        Correct: correct,  // <-- IMPORTANT
        Level: level,
        Timestamp: timestamp,
      },
    ],
  };

  fetch("https://sheetdb.io/api/v1/vtqyyfimz4iz1", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify(payload),
  })
    .then((res) => res.json())
    .then((data) => console.log("Logged:", data))
    .catch((err) => console.error("Error sending to SheetDB:", err));
}


    homePage.style.display = "flex";
  </script>
</body>
</html>
